<!doctype html>

<meta charset=utf-8>
<title>lnchannels.alhur.es</title>
<meta name=description content="A compendium of Lightning Network channels useful statistics.">
<link rel=stylesheet href=https://unpkg.com/tachyons@4.10.0/css/tachyons.min.css>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css>

<div>
   <canvas id=open-close></canvas>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>
<script>
var chartColors = {
  red: 'rgb(255, 99, 132)',
  orange: 'rgb(255, 159, 64)',
  yellow: 'rgb(255, 205, 86)',
  green: 'rgb(75, 192, 192)',
  blue: 'rgb(54, 162, 235)',
  purple: 'rgba(153, 102, 255, 0.5)',
  grey: 'rgb(201, 203, 207)'
}
var blocks = {{ blocks | safe | json_encode }}
var openings = {{ openings | safe | json_encode }}
var closings = {{ closings | safe | json_encode }}
var total = {{ total | safe | json_encode }}
new Chart(document.getElementById('open-close'), {
  type: 'line',
  data: {
    labels: blocks,
    datasets: [{
      label: 'Opened channels',
      backgroundColor: chartColors.blue,
      borderColor: chartColors.blue,
      data: openings,
      fill: false,
      pointRadius: 1,
      yAxisID: 'change',
    }, {
      label: 'Closed channels',
      backgroundColor: chartColors.red,
      borderColor: chartColors.red,
      data: closings,
      fill: false,
      pointRadius: 1,
      yAxisID: 'change',
    }, {
      label: 'Total channels',
      backgroundColor: chartColors.purple,
      borderColor: chartColors.purple,
      data: total,
      fill: true,
      pointRadius: 0,
      yAxisID: 'acc',
    }]
  },
  options: {
    responsive: true,
    title: {
      display: true,
      text: 'Channel variation'
    },
    tooltips: {
      mode: 'index',
      intersect: false,
    },
    hover: {
      mode: 'nearest',
      intersect: true
    },
    scales: {
      xAxes: [{
        display: true,
        scaleLabel: {
          display: true,
          labelString: 'Block number (every 100)'
        }
      }],
      yAxes: [{
        id: 'acc',
        type: 'linear',
        display: true,
        position: 'right',
        scaleLabel: {
          display: true,
          labelString: 'Total channels'
        }
      }, {
        id: 'change',
        type: 'logarithmic',
        display: true,
        position: 'left',
        scaleLabel: {
          display: true,
          labelString: 'Channel open/closes'
        },
        ticks: {
          callback: function (value, index, values) {
            if (index === 0 || index === values.length - 1 || value.toString()[0] === '1') {
              return '' + value;
            }
          }
        }
      }]
    }
  }
})
</script>
